<!DOCTYPE html>
<html>
<head>
    <title>IOC Management Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #eee; padding: 20px; }
        h1 { color: #00d9ff; margin-bottom: 20px; }
        h2 { color: #00d9ff; margin: 20px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: #16213e; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .component { display: flex; justify-content: space-between; align-items: center; }
        .component-info { flex: 1; }
        .component-name { font-weight: bold; color: #00d9ff; }
        .component-version { color: #888; font-size: 0.9em; }
        .component-desc { color: #aaa; font-size: 0.9em; margin-top: 5px; }
        .status { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; }
        .status.active { background: #00c853; color: #000; }
        .status.inactive { background: #ff5252; color: #fff; }
        .status.initializing { background: #ffc107; color: #000; }
        .type-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; margin-left: 10px; }
        .type-app { background: #7c4dff; }
        .type-plugin { background: #00bcd4; }
        .type-library { background: #ff9800; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        .btn-enable { background: #00c853; color: #000; }
        .btn-disable { background: #ff5252; color: #fff; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .state-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .state-item { background: #0f3460; padding: 15px; border-radius: 8px; text-align: center; }
        .state-value { font-size: 2em; color: #00d9ff; }
        .state-label { color: #888; font-size: 0.9em; }
        .refresh-btn { background: #00d9ff; color: #000; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h1>IOC Management Dashboard</h1>
    <button class="refresh-btn" onclick="refreshAll()">Refresh</button>

    <h2>Application State</h2>
    <div class="state-grid" id="state"></div>

    <h2>Components</h2>
    <div id="components"></div>

    <h2>Plugins</h2>
    <div id="plugins"></div>
</div>

<script>
    async function fetchState() {
        const res = await fetch('/api/state');
        const data = await res.json();
        const stateDiv = document.getElementById('state');
        stateDiv.innerHTML = `
            <div class="state-item">
                <div class="state-value">${data.total_components}</div>
                <div class="state-label">Total Components</div>
            </div>
            <div class="state-item">
                <div class="state-value">${data.initialized_components}</div>
                <div class="state-label">Initialized</div>
            </div>
            <div class="state-item">
                <div class="state-value">${data.plugins_count}</div>
                <div class="state-label">Plugins</div>
            </div>
            <div class="state-item">
                <div class="state-value">${data.libraries_count}</div>
                <div class="state-label">Libraries</div>
            </div>
        `;
    }

    async function fetchComponents() {
        const res = await fetch('/api/components');
        const data = await res.json();
        const componentsDiv = document.getElementById('components');
        componentsDiv.innerHTML = data.components.map(c => `
            <div class="card">
                <div class="component">
                    <div class="component-info">
                        <span class="component-name">${c.name}</span>
                        <span class="component-version">v${c.version}</span>
                        <span class="type-badge type-${c.type}">${c.type}</span>
                        <div class="component-desc">${c.description}</div>
                    </div>
                    <span class="status ${c.state.is_initialized ? 'active' : c.state.is_initializing ? 'initializing' : 'inactive'}">
                        ${c.state.is_initialized ? 'Active' : c.state.is_initializing ? 'Initializing' : 'Inactive'}
                    </span>
                </div>
            </div>
        `).join('');
    }

    async function fetchPlugins() {
        const res = await fetch('/api/plugins');
        const data = await res.json();
        const pluginsDiv = document.getElementById('plugins');
        if (data.plugins.length === 0) {
            pluginsDiv.innerHTML = '<div class="card">No plugins registered</div>';
            return;
        }
        pluginsDiv.innerHTML = data.plugins.map(p => `
            <div class="card">
                <div class="component">
                    <div class="component-info">
                        <span class="component-name">${p.name}</span>
                        <span class="component-version">v${p.version}</span>
                        <div class="component-desc">${p.description}</div>
                    </div>
                    <span class="status ${p.state.is_initialized ? 'active' : 'inactive'}">
                        ${p.state.is_initialized ? 'Active' : 'Inactive'}
                    </span>
                    ${p.state.is_initialized
                        ? `<button class="btn btn-disable" onclick="disablePlugin('${p.name}')" ${p.required_by.length > 0 ? 'disabled title="Required by other components"' : ''}>Disable</button>`
                        : `<button class="btn btn-enable" onclick="enablePlugin('${p.name}')">Enable</button>`
                    }
                </div>
            </div>
        `).join('');
    }

    async function enablePlugin(name) {
        await fetch('/api/plugins/enable', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name})
        });
        refreshAll();
    }

    async function disablePlugin(name) {
        await fetch('/api/plugins/disable', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name})
        });
        refreshAll();
    }

    function refreshAll() {
        fetchState();
        fetchComponents();
        fetchPlugins();
    }

    refreshAll();
    setInterval(refreshAll, 5000);
</script>
</body>
</html>
